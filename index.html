<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VIX Strategy Helper</title>

  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: row;
    }
    .sidebar {
      width: 260px;
      background: #fff;
      padding: 15px;
      border-right: 1px solid #ccc;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      height: 100vh;
      box-sizing: border-box;
      overflow-y: auto;
    }
    .sidebar h2 { font-size: 16px; margin-top: 0; }
    .sidebar .muted { font-size: 12px; color: #666; margin: 6px 0 10px 0; }
    .sidebar ul { padding-left: 18px; margin-top: 6px; margin-bottom: 18px; }

    .main { flex: 1; text-align: center; padding: 20px; }
    .calculator {
      background: #fff; padding: 15px; border-radius: 8px;
      box-shadow: 0 0 5px #ccc; max-width: 320px; margin: 0 auto 20px auto;
    }
    label { display: block; margin-top: 10px; }
    input { width: 100%; margin-top: 5px; margin-bottom: 10px; }
    input:disabled { opacity: 0.6; cursor: not-allowed; }
    button { width: 100%; padding: 8px; margin-top: 10px; }

    /* Unified recommendation block (ALL rows same size) */
    #recBlock {
      margin: 20px auto;
      padding: 15px;
      max-width: 900px;
      border-radius: 10px;
      box-shadow: 0 0 5px #ccc;
      color: #333;
      text-align: left;
      line-height: 1.35;
      font-size: 22px;
      font-weight: bold;
    }
    #recBlock .row { margin: 6px 0; }

    .flowchart { margin: 20px auto; max-width: 100%; overflow-x: auto; }
    .tag {
      display: inline-block; padding: 2px 6px; border-radius: 6px; font-size: 11px;
      border: 1px solid #ccc; color: #555; margin-left: 6px; background: #fafafa;
    }

    /* Bottom strategy section */
    .strategy-doc {
      background: #fff;
      padding: 20px;
      margin: 20px auto 60px auto;
      max-width: 900px;
      border-radius: 10px;
      box-shadow: 0 0 5px #ccc;
      text-align: left;
      line-height: 1.5;
    }
    .strategy-doc h2 { font-size: 20px; margin: 0 0 10px 0; }
    .strategy-doc h3 { font-size: 16px; margin: 18px 0 8px 0; color: #333; }
    .strategy-doc .divider { margin: 16px 0; text-align: center; color: #999; letter-spacing: 2px; }
    .strategy-doc ul { margin: 6px 0 12px 22px; }
    .strategy-doc li { margin: 2px 0; }
    .muted-note { font-size: 12px; color: #666; margin-top: 6px; }
    .highlight {
      background: #f6f6ff;
      border-left: 3px solid #b49aff;
      padding: 10px 12px;
      border-radius: 6px;
    }

    /* Crossed-out past dates in schedules + crossed signals */
    .crossed { text-decoration: line-through; color: #999; }
  </style>
</head>
<body>

<div class="sidebar">
  <h2>Straddle Trading Time</h2>
  <p>9:32 AM</p>
  <p class="muted">Last update: 10/20/2025</p>

  <!-- CPI Schedule -->
  <h2>CPI Schedule</h2>
  <ul id="cpiSchedule"></ul>

  <!-- Fed Day Schedule -->
  <h2>Fed Day Schedule</h2>
  <ul id="fedSchedule"></ul>

  <!-- OPEX (combined) -->
  <h2>OPEX</h2>
  <ul id="opexSchedule"></ul>

  <!-- Market Holidays -->
  <h2>Market Holidays</h2>
  <ul id="holidaySchedule"></ul>

  <!-- VIX Expiration -->
  <h2>VIX Expiration</h2>
  <ul id="vixExpirySchedule"></ul>
</div>

<div class="main">

  <div class="calculator">
    <h1>VIX Calculator</h1>
    <label>VIX Today’s Open:
      <input type="number" id="todayOpen" step="0.01" />
    </label>
    <label>VIX Yesterday’s Open:
      <input type="number" id="yesterdayOpen" step="0.01" />
    </label>
    <label>VIX Yesterday’s Close:
      <input type="number" id="yesterdayClose" step="0.01" />
    </label>
    <button onclick="calculateStrategy()">Calculate</button>
  </div>

  <div style="margin-top: 10px; font-size: 14px; text-align: center;">
    <p>
      <strong>Overnight VIX Drop:</strong>
      <span id="overnightDropDisplay">—</span>
      <span id="cpiTag" class="tag" style="display:none;">CPI day</span>
      <span id="fedTag" class="tag" style="display:none;">Fed day</span>
      <span id="opexTag" class="tag" style="display:none;">OPEX</span>
      <span id="postOpexTag" class="tag" style="display:none;">Post-OPEX</span>
      <span id="postHolidayTag" class="tag" style="display:none;">Post-Holiday</span>
      <span id="eomTag" class="tag" style="display:none;">EOM</span>
    </p>
    <p>
      <strong>Yesterday’s VIX Open − Today’s VIX Open:</strong>
      <span id="openDiffDisplay">—</span>
      <span id="openDiffNote" class="tag" style="display:none;">ignored on CPI day</span>
    </p>
  </div>

  <div style="text-align: right;">
    <div id="todayDate" style="font-size: 14px; color: #666; margin-bottom: 5px;"></div>
  </div>

  <!-- Unified recommendation + sub-signals block -->
  <div id="recBlock">
    <div class="row" id="mainRec">—</div>
    <div class="row" id="onePmLine">—</div>
    <div class="row" id="bobfLine">—</div>
  </div>

  <div class="flowchart">
    <div class="mermaid">
flowchart TD
  A[SPX overnight gap &lt; 0.9%?]
  A -->|No| M[M8 Butterfly]
  A -->|Yes| D[Overnight VIX drop &gt; 0.65?]
  D -->|Yes| X[GXBF @ 9:36 AM]
  D -->|No| O[Open-to-open VIX &gt; 1.4?]
  O -->|Yes| M2[M8 Butterfly]
  O -->|No| S[Overnight VIX drop 0.01–0.65?]
  S -->|Yes| T[Straddle @ 9:32 AM]
  S -->|No| M3[M8 Butterfly]

  class M,M2,M3 butterfly
  class X atm
  class T straddle

  classDef butterfly fill:#b49aff,stroke:#333,stroke-width:1px
  classDef straddle fill:#61f7d6,stroke:#333,stroke-width:1px
  classDef atm fill:#fff399,stroke:#333,stroke-width:1px
    </div>
  </div>

  <!-- Bottom strategy documentation -->
  <section class="strategy-doc" id="strategy-doc">
    <h2>Hybrid SPX 0DTE Strategy — Overview</h2>
    <p>This is the hybrid SPX 0DTE strategy. It classifies days into three distinct types:</p>

    <div class="highlight">
      <h3>Teal Days — Straddle</h3>
      <ul><li>Traded between <strong>9:32 AM</strong> and <strong>1:30 PM</strong>.</li></ul>

      <h3>Purple Days — M8 Butterfly</h3>
      <ul>
        <li>Based on M8’s recommendation.</li>
        <li>This setup is less effective without TTV software, which helps identify optimal entry windows for butterflies.</li>
        <li>I’ll try my best to update the best entry times weekly on my webpage.</li>
      </ul>

      <h3>Yellow Days — Gex Butterfly (GXBF)</h3>
      <ul>
        <li>Traded at <strong>9:36 AM</strong>, centered around a major positive gamma value taken from <strong>9:35 AM gex-bot-stream</strong> feed.</li>
      </ul>
    </div>

    <div class="divider">⸻</div>

    <h3>Rules for Day Classification</h3>
    <p>Here’s the logic:</p>
    <ul>
      <li><strong>Check SPX overnight gap at the open:</strong><br/>
        • If the gap (up or down) is <strong>&gt; 0.9%</strong>, it’s a <strong>Purple Day (M8 Butterfly)</strong>.<br/>
        • If the gap is <strong>&lt; 0.9%</strong>, continue:
      </li>

      <li><strong>Overnight VIX drop:</strong> (Yesterday’s VIX close @ 4:15 PM − today’s VIX open @ 9:30 AM)<br/>
        • If <strong>&gt; 0.65</strong> → <strong>Yellow Day (GXBF @ 9:36 AM)</strong>.<br/>
        • If <strong>0.01–0.65</strong> → <strong>Teal Day (Straddle @ 9:32 AM)</strong>.<br/>
        • Otherwise continue:
      </li>

      <li><strong>Open-to-open VIX:</strong> Yesterday’s VIX open − today’s VIX open.<br/>
        • If this value is <strong>&gt; 1.4</strong>, it’s a <strong>Purple Day</strong>.<br/>
        • Otherwise:
      </li>

      <li>If none of the above conditions are met → <strong>Purple Day (M8 Butterfly)</strong>.</li>
    </ul>

    <ul>
      <li><strong>CPI days:</strong> Use <em>only</em> one filter → <strong>Yesterday’s Close − Today’s Open</strong>.<br/>
        • If negative → <strong>No Trade</strong>.<br/>
        • If zero/positive → <strong>Straddle @ 9:32 AM</strong>.
      </li>

      <li><strong>Fed days:</strong> <strong>No M8 Butterfly.</strong> Straddle and GXBF are allowed.</li>

      <li><strong>Wednesdays (non-Fed, non-CPI):</strong> NO Straddle → take M8 Butterfly instead.</li>

      <li><strong>Day After Market Holiday:</strong> No M8 Butterflies.</li>

      <li><strong>End-of-Month (EOM):</strong> Automatic Straddle @ 9:32 AM (“EOM Straddle”).</li>

      <li><strong>0% Win-Rate Rule:</strong> If the M8 SPX Butterfly prediction has a 0% win rate for the entire day, then the next day we automatically take a 9:32 AM Straddle trade, using the same rules as the overnight VIX-down (Teal day) straddle.</li>
    </ul>

    <h3>Additional Trade Signals</h3>
    <ul>
      <li><strong>BOBF rules:</strong>
        Skip Fridays, monthly VIX expiration days, OPEX-1, and EOM-2 / EOM-1. Also require VIX between 15 and 23.
      </li>
      <li><strong>1PM BF rules:</strong>
        Skip Mondays, trade only on overnight VIX up days, skip monthly VIX expiration days,
        skip EOM and EOM-1, skip if VIX open &lt; 16. Max risk $1,400.
      </li>
    </ul>

    <h3>Money Management</h3>
    <ul>
      <li><strong>Butterflies (Purple & Yellow):</strong> Max risk <strong>$1,400</strong>.</li>
      <li><strong>Straddles (Teal):</strong> Max risk <strong>$3,200</strong>. On <strong>Thursdays</strong>, use <strong>$2,700 take-profit</strong>.</li>
      <li>All trades are held to <strong>expiration</strong>.</li>
    </ul>

    <p class="muted-note"><strong>Disclaimer:</strong> This content is for informational and educational purposes only and does not constitute financial, investment, or trading advice.</p>
  </section>

</div>

<script>
/* -------------------- SCHEDULES -------------------- */

// CPI dates (remaining 2025)
const cpiSchedule = [
  "September 11, 2025",
  "October 24, 2025",
  "November 13, 2025",
  "December 18, 2025"
];

// Fed Day dates (remaining 2025)
const fedSchedule = [
  "September 17, 2025",
  "October 29, 2025",
  "December 10, 2025"
];

// OPEX (combined monthly + quarterly) — 2025
const opexSchedule = [
  // Monthly (non-quarterly)
  "January 17, 2025",
  "February 21, 2025",
  "April 17, 2025",
  "May 16, 2025",
  "July 18, 2025",
  "August 15, 2025",
  "October 17, 2025",
  "November 21, 2025",
  // Quarterly
  "March 21, 2025",
  "June 20, 2025",
  "September 19, 2025",
  "December 19, 2025"
];

// US Market Holidays — 2025 (observed full-day closures)
const marketHolidays = [
  "January 1, 2025",
  "January 20, 2025",
  "February 17, 2025",
  "April 18, 2025",
  "May 26, 2025",
  "June 19, 2025",
  "July 4, 2025",
  "September 1, 2025",
  "November 27, 2025",
  "December 25, 2025"
];

// VIX monthly expirations — remaining 2025
const vixExpirySchedule = [
  "October 22, 2025",
  "November 19, 2025",
  "December 17, 2025"
];

/* -------------------- RENDER LISTS -------------------- */
function renderList(ulId, arr) {
  const ul = document.getElementById(ulId);
  if (!ul) return;
  arr.forEach(date => {
    const li = document.createElement('li');
    li.textContent = date;
    li.setAttribute('data-date', date);
    ul.appendChild(li);
  });
}
renderList('cpiSchedule', cpiSchedule);
renderList('fedSchedule', fedSchedule);
renderList('opexSchedule', opexSchedule);
renderList('holidaySchedule', marketHolidays);
renderList('vixExpirySchedule', vixExpirySchedule);

/* -------------------- DATE HELPERS -------------------- */
function hasPassed(dateStr) {
  const d = new Date(dateStr);
  if (isNaN(d)) return false;
  const endOfDay = new Date(d.getFullYear(), d.getMonth(), d.getDate(), 23, 59, 59, 999);
  return new Date() > endOfDay;
}
function crossOffPastDates(ulId) {
  const ul = document.getElementById(ulId);
  if (!ul) return;
  Array.from(ul.children).forEach(li => {
    const dateText = li.getAttribute('data-date') || li.textContent.trim();
    if (hasPassed(dateText)) li.classList.add('crossed');
  });
}
function refreshCrossedDates() {
  crossOffPastDates('cpiSchedule');
  crossOffPastDates('fedSchedule');
  crossOffPastDates('opexSchedule');
  crossOffPastDates('holidaySchedule');
  crossOffPastDates('vixExpirySchedule');
}
document.addEventListener('DOMContentLoaded', () => {
  refreshCrossedDates();
  const now = new Date();
  const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 2);
  setTimeout(() => {
    refreshCrossedDates();
    setInterval(refreshCrossedDates, 24 * 60 * 60 * 1000);
  }, midnight - now);
});

function todayLongUS() {
  return new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}
function isCpiDay() { return cpiSchedule.includes(todayLongUS()); }
function isFedDay() { return fedSchedule.includes(todayLongUS()); }
function isOpexDay() { return opexSchedule.includes(todayLongUS()); }
function isVixExpiryDay() { return vixExpirySchedule.includes(todayLongUS()); }

// Trading-day helpers
function isWeekend(d) { const day = d.getDay(); return day === 0 || day === 6; }
function isHoliday(d) {
  const asLong = d.toLocaleDateString('en-US', { month:'long', day:'numeric', year:'numeric' });
  return marketHolidays.includes(asLong);
}
function nextTradingDay(d) {
  const nd = new Date(d);
  do { nd.setDate(nd.getDate() + 1); } while (isWeekend(nd) || isHoliday(nd));
  return nd;
}
function prevTradingDay(d) {
  const pd = new Date(d);
  do { pd.setDate(pd.getDate() - 1); } while (isWeekend(pd) || isHoliday(pd));
  return pd;
}
function isTodayFirstTradingDayAfter(dateStr) {
  const d = new Date(dateStr);
  if (isNaN(d)) return false;
  const after = nextTradingDay(d);
  const today = new Date();
  return after.getFullYear() === today.getFullYear()
      && after.getMonth() === today.getMonth()
      && after.getDate() === today.getDate();
}
function isPostOpexMonday() {
  const postAny = opexSchedule.some(isTodayFirstTradingDayAfter);
  return postAny && new Date().getDay() === 1;
}
function isPostHoliday() {
  return marketHolidays.some(isTodayFirstTradingDayAfter);
}

// EOM detection (last TRADING day of month)
function isLastTradingDayOfMonth(date = new Date()) {
  const next = nextTradingDay(date);
  return next.getMonth() !== date.getMonth();
}

// EOM-1 / EOM-2 (trading days before last trading day of month)
function lastTradingDayOfMonth(date = new Date()) {
  const d = new Date(date.getFullYear(), date.getMonth() + 1, 0);
  while (isWeekend(d) || isHoliday(d)) d.setDate(d.getDate() - 1);
  return d;
}
function isEomMinusN(n, date = new Date()) {
  const ltd = lastTradingDayOfMonth(date);
  let d = new Date(ltd);
  for (let i = 0; i < n; i++) d = prevTradingDay(d);
  return d.getFullYear() === date.getFullYear() &&
         d.getMonth() === date.getMonth() &&
         d.getDate() === date.getDate();
}

// OPEX-1 (day before OPEX)
function isOpexMinus1Today() {
  const today = new Date();
  return opexSchedule.some(ds => {
    const od = new Date(ds);
    if (isNaN(od)) return false;
    const opexMinus1 = prevTradingDay(od);
    return opexMinus1.getFullYear() === today.getFullYear() &&
           opexMinus1.getMonth() === today.getMonth() &&
           opexMinus1.getDate() === today.getDate();
  });
}

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('todayDate').textContent =
    "Today’s Date: " + new Date().toLocaleDateString();
});

// CPI UI: disable Yesterday Open input only on CPI days
function updateCpiUI() {
  document.getElementById('yesterdayOpen').disabled = isCpiDay();
}
document.addEventListener('DOMContentLoaded', updateCpiUI);

/* -------------------- CALCULATOR -------------------- */
function calculateStrategy() {
  const today = parseFloat(document.getElementById('todayOpen').value);
  const yOpen = parseFloat(document.getElementById('yesterdayOpen').value);
  const yClose = parseFloat(document.getElementById('yesterdayClose').value);

  if (isNaN(today) || isNaN(yClose) || (!isCpiDay() && isNaN(yOpen))) {
    alert("Please enter valid numbers.");
    return;
  }

  const cpiToday = isCpiDay();
  const fedToday = isFedDay();
  const opexToday = isOpexDay();
  const postOpexMon = isPostOpexMonday();
  const postHoliday = isPostHoliday();
  const eomTradingDay = isLastTradingDayOfMonth(new Date());
  const eomMinus1 = isEomMinusN(1, new Date());
  const eomMinus2 = isEomMinusN(2, new Date());
  const opexMinus1Today = isOpexMinus1Today();

  const dayOfWeek = new Date().getDay();
  const isMonday = dayOfWeek === 1;
  const isFriday = dayOfWeek === 5;
  const isWednesday = dayOfWeek === 3;

  const vixExpiryToday = isVixExpiryDay();

  // tags
  document.getElementById('cpiTag').style.display = cpiToday ? 'inline-block' : 'none';
  document.getElementById('fedTag').style.display = fedToday ? 'inline-block' : 'none';
  document.getElementById('opexTag').style.display = opexToday ? 'inline-block' : 'none';
  document.getElementById('postOpexTag').style.display = postOpexMon ? 'inline-block' : 'none';
  document.getElementById('postHolidayTag').style.display = postHoliday ? 'inline-block' : 'none';
  document.getElementById('eomTag').style.display = eomTradingDay ? 'inline-block' : 'none';

  // calculations
  const openDiff = (isNaN(yOpen) ? NaN : yOpen - today);   // ignored on CPI day
  const overnightDrop = yClose - today;                   // CPI rule uses this (Yesterday Close - Today Open)

  document.getElementById('overnightDropDisplay').textContent =
    isNaN(overnightDrop) ? '—' : overnightDrop.toFixed(2);

  const openDiffDisplay = document.getElementById('openDiffDisplay');
  const openDiffNote = document.getElementById('openDiffNote');
  if (cpiToday) {
    openDiffDisplay.textContent = '—';
    openDiffNote.style.display = 'inline-block';
  } else {
    openDiffNote.style.display = 'none';
    openDiffDisplay.textContent = isNaN(openDiff) ? '—' : openDiff.toFixed(2);
  }

  // MAIN recommendation
  let recommendation = "";
  let bgColor = "#eee";
  let isNoTrade = false;

  if (cpiToday) {
    // CPI: Yesterday Close − Today Open only
    if (overnightDrop < 0) {
      recommendation = "No Trade (CPI day)";
      bgColor = "#eee";
      isNoTrade = true;
    } else {
      recommendation = "Straddle @ 9:32 AM (CPI day)";
      bgColor = "#61f7d6";
    }
  } else {
    // GXBF priority over open-to-open
    if (overnightDrop > 0.65) {
      recommendation = "Gex Butterfly (GXBF) @ 9:36 AM";
      bgColor = "#fff399";
    } else if (openDiff > 1.4) {
      recommendation = "M8 Butterfly";
      bgColor = "#b49aff";
    } else if (overnightDrop >= 0.01 && overnightDrop < 0.65) {
      recommendation = "Straddle @ 9:32 AM";
      bgColor = "#61f7d6";
    } else {
      recommendation = "M8 Butterfly";
      bgColor = "#b49aff";
    }

    // Fed-day blocks M8 only
    if (fedToday && recommendation === "M8 Butterfly") {
      recommendation = "No Trade (Fed day — no M8 butterflies)";
      bgColor = "#eee";
      isNoTrade = true;
    }

    // Day after holiday blocks M8 only
    if (postHoliday && recommendation === "M8 Butterfly") {
      recommendation = "No Trade (day after market holiday — no M8 butterflies)";
      bgColor = "#eee";
      isNoTrade = true;
    }

    // EOM override
    if (eomTradingDay) {
      recommendation = "Straddle @ 9:32 AM (EOM Straddle)";
      bgColor = "#61f7d6";
      isNoTrade = false;
    }

    // Wednesday rule (not on Fed/CPI/EOM): if Straddle => M8
    if (isWednesday && !fedToday && !cpiToday && !eomTradingDay && recommendation.includes("Straddle")) {
      recommendation = "M8 Butterfly";
      bgColor = "#b49aff";
    }

    // Post-OPEX Monday note if M8 signal
    if (postOpexMon && recommendation === "M8 Butterfly") {
      recommendation = "M8 Butterfly (use afternoon times for post opex Mondays)";
      bgColor = "#b49aff";
    }
  }

  // OPEX override: block Straddle (No Trade)
  if (opexToday && recommendation.includes("Straddle")) {
    recommendation = "No Trade (OPEX — no Straddles)";
    bgColor = "#eee";
    isNoTrade = true;
  }

  // Render unified block
  const recBlock = document.getElementById("recBlock");
  const mainRec = document.getElementById("mainRec");
  const onePmLine = document.getElementById("onePmLine");
  const bobfLine = document.getElementById("bobfLine");

  recBlock.style.backgroundColor = bgColor;

  if (isNoTrade || recommendation.startsWith("No Trade")) {
    mainRec.innerHTML = `<span class="crossed">${recommendation}</span>`;
  } else {
    mainRec.textContent = recommendation;
  }

  /* -------------------- 1PM BF -------------------- */
  // Overnight VIX up days: Today Open > Yesterday Close  -> overnightDrop < 0
  // Also skip: Monday, VIX expiry, EOM, EOM-1, VIX open < 16
  // Also skip day after 0% M8BF day (no data source in this page)
  const m8ZeroYesterday = false; // placeholder (no data source on this page)

  let onePmOk = true;
  let onePmReason = "";

  if (!(overnightDrop < 0)) { onePmOk = false; onePmReason = "Overnight VIX not up"; }
  if (onePmOk && isMonday) { onePmOk = false; onePmReason = "Monday"; }
  if (onePmOk && vixExpiryToday) { onePmOk = false; onePmReason = "VIX expiration"; }
  if (onePmOk && eomTradingDay) { onePmOk = false; onePmReason = "EOM"; }
  if (onePmOk && eomMinus1) { onePmOk = false; onePmReason = "EOM-1"; }
  if (onePmOk && today < 16) { onePmOk = false; onePmReason = "Low VIX"; }
  if (onePmOk && m8ZeroYesterday) { onePmOk = false; onePmReason = "Post 0% M8BF day"; }

  if (onePmOk) {
    onePmLine.textContent = "1PM BF in play";
  } else {
    const r = onePmReason ? ` (${onePmReason})` : "";
    onePmLine.innerHTML = `<span class="crossed">No 1PM BF${r}</span>`;
  }

  /* -------------------- BOBF -------------------- */
  // Skip: Friday, VIX expiry, OPEX-1, EOM-2, EOM-1
  // VIX range: 15–23 using today's open
  let bobfOk = true;
  let bobfReason = "";

  if (isFriday) { bobfOk = false; bobfReason = "Friday"; }
  if (bobfOk && vixExpiryToday) { bobfOk = false; bobfReason = "VIX expiration"; }
  if (bobfOk && opexMinus1Today) { bobfOk = false; bobfReason = "OPEX-1"; }
  if (bobfOk && eomMinus2) { bobfOk = false; bobfReason = "EOM-2"; }
  if (bobfOk && eomMinus1) { bobfOk = false; bobfReason = "EOM-1"; }
  if (bobfOk && (today < 15 || today > 23)) { bobfOk = false; bobfReason = "VIX out of range"; }

  if (bobfOk) {
    bobfLine.textContent = "BOBF in play";
  } else {
    const r = bobfReason ? ` (${bobfReason})` : "";
    bobfLine.innerHTML = `<span class="crossed">No BOBF${r}</span>`;
  }

  // Keep CPI input lock correct
  document.getElementById('yesterdayOpen').disabled = cpiToday;
}
</script>

</body>
</html>
