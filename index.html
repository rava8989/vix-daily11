<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VIX Strategy Helper</title>

  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: row;
    }
    .sidebar {
      width: 250px;
      background: #fff;
      padding: 15px;
      border-right: 1px solid #ccc;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      height: 100vh;
      box-sizing: border-box;
      overflow-y: auto;
    }
    .sidebar h2 { font-size: 16px; margin-top: 0; }
    .sidebar .muted { font-size: 12px; color: #666; margin: 6px 0 10px 0; }
    .sidebar ul { padding-left: 18px; margin-top: 6px; margin-bottom: 18px; }

    .main { flex: 1; text-align: center; padding: 20px; }
    .calculator {
      background: #fff; padding: 15px; border-radius: 8px;
      box-shadow: 0 0 5px #ccc; max-width: 300px; margin: 0 auto 20px auto;
    }
    label { display: block; margin-top: 10px; }
    input { width: 100%; margin-top: 5px; margin-bottom: 10px; }
    input:disabled { opacity: 0.6; cursor: not-allowed; }
    button { width: 100%; padding: 8px; margin-top: 10px; }

    /* Unified recommendation block */
    #recBlock {
      margin: 20px auto;
      padding: 15px;
      max-width: 880px;
      border-radius: 8px;
      box-shadow: 0 0 5px #ccc;
      color: #333;
      text-align: left;
      line-height: 1.35;
      font-size: 28px;          /* same size for all lines */
    }
    #recBlock .row { margin: 6px 0; }
    #recBlock .mainline { font-weight: bold; }

    .flowchart { margin: 20px auto; max-width: 100%; overflow-x: auto; }
    .tag {
      display: inline-block; padding: 2px 6px; border-radius: 6px; font-size: 11px;
      border: 1px solid #ccc; color: #555; margin-left: 6px; background: #fafafa;
    }

    /* Bottom strategy section */
    .strategy-doc {
      background: #fff;
      padding: 20px;
      margin: 20px auto 60px auto;
      max-width: 900px;
      border-radius: 10px;
      box-shadow: 0 0 5px #ccc;
      text-align: left;
      line-height: 1.5;
    }
    .strategy-doc h2 { font-size: 20px; margin: 0 0 10px 0; }
    .strategy-doc h3 { font-size: 16px; margin: 18px 0 8px 0; color: #333; }
    .strategy-doc .divider { margin: 16px 0; text-align: center; color: #999; letter-spacing: 2px; }
    .strategy-doc ul { margin: 6px 0 12px 22px; }
    .strategy-doc li { margin: 2px 0; }
    .muted-note { font-size: 12px; color: #666; margin-top: 6px; }
    .highlight {
      background: #f6f6ff;
      border-left: 3px solid #b49aff;
      padding: 10px 12px;
      border-radius: 6px;
    }

    /* Crossed-out past dates in schedules + blocked signals */
    .crossed { text-decoration: line-through; color: #999; }
  </style>
</head>

<body>

<div class="sidebar">
  <h2>Straddle Trading Time</h2>
  <p>9:32 AM</p>
  <p class="muted">Last update: 10/20/2025</p>

  <!-- CPI Schedule -->
  <h2>CPI Schedule</h2>
  <ul id="cpiSchedule"></ul>

  <!-- Fed Day Schedule -->
  <h2>Fed Day Schedule</h2>
  <ul id="fedSchedule"></ul>

  <!-- OPEX (combined list) -->
  <h2>OPEX Days</h2>
  <ul id="opexSchedule"></ul>

  <!-- Market Holidays -->
  <h2>Market Holidays</h2>
  <ul id="holidaySchedule"></ul>

  <!-- VIX Expiration -->
  <h2>VIX Expiration</h2>
  <ul id="vixExpirySchedule"></ul>
</div>

<div class="main">

  <div class="calculator">
    <h1>VIX Calculator</h1>
    <label>VIX Today’s Open:
      <input type="number" id="todayOpen" step="0.01" />
    </label>
    <label>VIX Yesterday’s Open:
      <input type="number" id="yesterdayOpen" step="0.01" />
    </label>
    <label>VIX Yesterday’s Close:
      <input type="number" id="yesterdayClose" step="0.01" />
    </label>
    <button onclick="calculateStrategy()">Calculate</button>
  </div>

  <div style="margin-top: 10px; font-size: 14px; text-align: center;">
    <p>
      <strong>Overnight VIX Drop:</strong>
      <span id="overnightDropDisplay">—</span>
      <span id="cpiTag" class="tag" style="display:none;">CPI day</span>
      <span id="fedTag" class="tag" style="display:none;">Fed day</span>
      <span id="opexTag" class="tag" style="display:none;">OPEX</span>
      <span id="postOpexTag" class="tag" style="display:none;">Post-OPEX</span>
      <span id="postHolidayTag" class="tag" style="display:none;">Post-Holiday</span>
      <span id="eomTag" class="tag" style="display:none;">EOM</span>
    </p>
    <p>
      <strong>Yesterday’s VIX Open − Today’s VIX Open:</strong>
      <span id="openDiffDisplay">—</span>
      <span id="openDiffNote" class="tag" style="display:none;">ignored on CPI day</span>
    </p>
  </div>

  <div style="text-align: right;">
    <div id="todayDate" style="font-size: 14px; color: #666; margin-bottom: 5px;"></div>
  </div>

  <!-- Unified recommendation + sub-signals block -->
  <div id="recBlock">
    <div class="row mainline" id="mainRec">—</div>
    <div class="row" id="pm1Line">—</div>
    <div class="row" id="bobfLine">—</div>
  </div>

  <div class="flowchart">
    <div class="mermaid">
flowchart TD
  A["SPX overnight gap < 0.9%?"]
  A -->|No| M1["M8 Butterfly"]
  A -->|Yes| D["Overnight VIX drop > 0.65?"]
  D -->|Yes| Y["GXBF @ 9:36 AM"]
  D -->|No| C["Open-to-open VIX > 1.4?"]
  C -->|Yes| M2["M8 Butterfly"]
  C -->|No| F["Overnight VIX drop 0.01–0.65?"]
  F -->|Yes| S["Straddle @ 9:32 AM"]
  F -->|No| M3["M8 Butterfly"]

  class M1,M2,M3 butterfly
  class Y atm
  class S straddle

  classDef butterfly fill:#b49aff,stroke:#333,stroke-width:1px
  classDef straddle fill:#61f7d6,stroke:#333,stroke-width:1px
  classDef atm fill:#fff399,stroke:#333,stroke-width:1px
    </div>
  </div>

  <!-- Bottom strategy documentation -->
  <section class="strategy-doc" id="strategy-doc">
  <h2>Sigma 3 — SPX 0DTE Strategy Overview</h2>

  <p>
    Sigma 3 is a rules-based SPX 0DTE framework that combines multiple option structures.
    The VIX calculator determines which trade (if any) is valid for the day based on
    overnight VIX behavior, calendar constraints, and risk limits.
  </p>

  <div class="divider">⸻</div>

  <h3>M8 Butterfly (M8BF)</h3>
  <ul>
    <li>Used when overnight VIX is <strong>up</strong> or flat.</li>
    <li>Triggered when <strong>open-to-open VIX &gt; 1.4</strong>, or when overnight VIX does not meet straddle or GXBF thresholds.</li>
    <li><strong>Not traded</strong> on Fed days.</li>
    <li><strong>Not traded</strong> on the first trading day after a market holiday (unless overridden by NM rule).</li>
    <li>On the first trading day of the month (NM), M8BF converts to <strong>NM Straddle</strong>.</li>
    <li>Post-OPEX Monday note: when M8BF appears, afternoon timing is preferred.</li>
    <li>Max risk: <strong>$1,400</strong>.</li>
  </ul>

  <div class="divider">⸻</div>

  <h3>Straddle</h3>
  <ul>
    <li>Used when overnight VIX is <strong>moderately down</strong> (<strong>0.01 – 0.65</strong>).</li>
    <li>Entry time: <strong>9:32 AM</strong>.</li>
    <li><strong>Not traded</strong> on OPEX days.</li>
    <li>On Wednesdays (non-Fed, non-CPI), straddles convert to M8BF unless overridden.</li>
    <li><strong>End-of-Month (EOM):</strong> automatic <strong>EOM Straddle</strong>.</li>
    <li><strong>NM rule:</strong> On the first trading day of the month, if M8BF would be selected, trade <strong>NM Straddle</strong> instead (not on Mondays).</li>
    <li>EOM Straddle max risk: <strong>$3,500</strong>.</li>
  </ul>

  <div class="divider">⸻</div>

  <h3>GXBF (GEX Butterfly)</h3>
  <ul>
    <li>Used when overnight VIX is <strong>strongly down</strong> (<strong>&gt; 0.65</strong>).</li>
    <li>Takes priority over open-to-open VIX logic.</li>
    <li>Entry time: <strong>9:36 AM</strong>, centered on major positive gamma.</li>
    <li>Allowed on Fed days.</li>
    <li>Max risk: <strong>$1,400</strong>.</li>
  </ul>

  <div class="strategy-image">
    <img src="Gex.jpg" alt="GXBF strategy visual">
  </div>

  <div class="divider">⸻</div>

  <h3>1PM Butterfly (1PM BF)</h3>
  <ul>
    <li>Only traded when overnight VIX is <strong>up</strong>.</li>
    <li><strong>Not traded</strong> on Mondays.</li>
    <li><strong>Not traded</strong> on VIX expiration days.</li>
    <li><strong>Not traded</strong> on EOM or EOM-1.</li>
    <li><strong>Not traded</strong> if VIX open is <strong>below 16</strong>.</li>
    <li>Max risk: <strong>$1,400</strong>.</li>
  </ul>

  <div class="divider">⸻</div>

  <h3>BOBF</h3>
  <ul>
    <li><strong>Not traded</strong> on Fridays.</li>
    <li><strong>Not traded</strong> on monthly VIX expiration days.</li>
    <li><strong>Not traded</strong> on OPEX-1.</li>
    <li><strong>Not traded</strong> on EOM-2 and EOM-1.</li>
    <li>Maximum VIX allowed: <strong>23</strong>.</li>
  </ul>

  <div class="strategy-image">
    <img src="BOBF.jpg" alt="BOBF strategy visual">
  </div>

  <div class="divider">⸻</div>

  <h3>CPI Rule</h3>
  <ul>
    <li>Uses only <strong>Yesterday’s VIX Close − Today’s VIX Open</strong>.</li>
    <li>If VIX is <strong>down</strong>: trade <strong>Long ATM Call @ 9:32 AM</strong>.</li>
    <li>Max entry premium: <strong>$13</strong>.</li>
    <li>If VIX is up or flat: <strong>No trade</strong>.</li>
  </ul>

  <div class="divider">⸻</div>

  <p>
    All trades are held to expiration.  
    Only one primary trade is allowed per day.
  </p>

  <p class="muted-note">
    <strong>Disclaimer:</strong> This content is for informational and educational purposes only and does not constitute financial or investment advice. Trading options involves significant risk.
  </p>
</section>
/* ===== SCHEDULES ===== */

// CPI dates (remaining 2025)
const cpiSchedule = [
  "January 23, 2026",
  "February 11, 2026",
  "March 11, 2026",
  "April 10, 2026",
  "June 10, 2026",
  "July 14, 2026",
  "August 12, 2026",
  "September 11, 2026",
  "October 14, 2026",
  "November 10, 2026",
  "December 10, 2026"
];

// Fed Day dates (remaining 2025)
const fedSchedule = [
  "January 28, 2026",
  "March 18, 2026",
  "April 29, 2026",
  "June 17, 2026",
  "July 29, 2026",
  "September 16, 2026",
  "October 28, 2026",
  "December 9, 2026"
];

// OPEX Days (combined: quarterlies + non-quarterlies) — 2025
const opexSchedule = [
  "January 16, 2026",
  "February 20, 2026",
  "March 20, 2026",
  "April 17, 2026",
  "May 15, 2026",
  "June 18, 2026",
  "July 17, 2026",
  "August 21, 2026",
  "September 18, 2026",
  "October 16, 2026",
  "November 20, 2026",
  "December 18, 2026"
];

// US Market Holidays — 2025 (observed full-day closures)
const marketHolidays = [
  "January 1, 2026",
  "January 19, 2026",
  "February 16, 2026",
  "April 3, 2026",
  "May 25, 2026",
  "June 19, 2026",
  "July 3, 2026",
  "September 7, 2026",
  "November 26, 2026",
  "December 25, 2026"
];

// VIX monthly option expirations — remaining 2025
const vixExpirySchedule = [
  "January 21, 2026",
  "February 18, 2026",
  "March 18, 2026",
  "April 15, 2026",
  "May 20, 2026",
  "June 17, 2026",
  "July 15, 2026",
  "August 19, 2026",
  "September 16, 2026",
  "October 21, 2026",
  "November 18, 2026",
  "December 16, 2026"
];

/* ===== RENDER SCHEDULES ===== */

function renderSchedule(list, ulId) {
  const ul = document.getElementById(ulId);
  list.forEach(date => {
    const li = document.createElement('li');
    li.textContent = date;
    li.setAttribute('data-date', date);
    ul.appendChild(li);
  });
}

renderSchedule(cpiSchedule, 'cpiSchedule');
renderSchedule(fedSchedule, 'fedSchedule');
renderSchedule(opexSchedule, 'opexSchedule');
renderSchedule(marketHolidays, 'holidaySchedule');
renderSchedule(vixExpirySchedule, 'vixExpirySchedule');

/* ===== CROSS OFF PAST DATES ===== */

function hasPassed(dateStr) {
  const d = new Date(dateStr);
  if (isNaN(d)) return false;
  const endOfDay = new Date(d.getFullYear(), d.getMonth(), d.getDate(), 23, 59, 59, 999);
  return new Date() > endOfDay;
}
function crossOffPastDates(ulId) {
  const ul = document.getElementById(ulId);
  if (!ul) return;
  Array.from(ul.children).forEach(li => {
    const dateText = li.getAttribute('data-date') || li.textContent.trim();
    if (hasPassed(dateText)) li.classList.add('crossed');
  });
}
function refreshCrossedDates() {
  crossOffPastDates('cpiSchedule');
  crossOffPastDates('fedSchedule');
  crossOffPastDates('opexSchedule');
  crossOffPastDates('holidaySchedule');
  crossOffPastDates('vixExpirySchedule');
}
document.addEventListener('DOMContentLoaded', () => {
  refreshCrossedDates();
  const now = new Date();
  const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 2);
  setTimeout(() => {
    refreshCrossedDates();
    setInterval(refreshCrossedDates, 24 * 60 * 60 * 1000);
  }, midnight - now);
});

/* ===== DATE HELPERS ===== */

function todayLongUS() {
  return new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}
function isCpiDay() { return cpiSchedule.includes(todayLongUS()); }
function isFedDay() { return fedSchedule.includes(todayLongUS()); }
function isOpexDay() { return opexSchedule.includes(todayLongUS()); }
function isVixExpiryDay() { return vixExpirySchedule.includes(todayLongUS()); }

function isWeekend(d) { const day = d.getDay(); return day === 0 || day === 6; }
function isHoliday(d) {
  const asLong = d.toLocaleDateString('en-US', { month:'long', day:'numeric', year:'numeric' });
  return marketHolidays.includes(asLong);
}
function nextTradingDay(d) {
  const nd = new Date(d);
  do { nd.setDate(nd.getDate() + 1); } while (isWeekend(nd) || isHoliday(nd));
  return nd;
}
function prevTradingDay(d) {
  const pd = new Date(d);
  do { pd.setDate(pd.getDate() - 1); } while (isWeekend(pd) || isHoliday(pd));
  return pd;
}
function isTodayFirstTradingDayAfter(dateStr) {
  const d = new Date(dateStr);
  if (isNaN(d)) return false;
  const after = nextTradingDay(d);
  const today = new Date();
  return after.getFullYear() === today.getFullYear()
      && after.getMonth() === today.getMonth()
      && after.getDate() === today.getDate();
}
function isPostHoliday() { return marketHolidays.some(isTodayFirstTradingDayAfter); }
function isPostOpexMonday() {
  const postAnyOpex = opexSchedule.some(isTodayFirstTradingDayAfter);
  return postAnyOpex && new Date().getDay() === 1;
}

// EOM detection (last TRADING day of month)
function isLastTradingDayOfMonth(date = new Date()) {
  const next = nextTradingDay(date);
  return next.getMonth() !== date.getMonth();
}
function isEomMinusN(n, date = new Date()) {
  const firstNextMonth = new Date(date.getFullYear(), date.getMonth() + 1, 1);
  const eom = prevTradingDay(firstNextMonth); // last trading day of current month
  let target = new Date(eom);
  for (let i = 0; i < n; i++) target = prevTradingDay(target);
  return target.getFullYear() === date.getFullYear()
      && target.getMonth() === date.getMonth()
      && target.getDate() === date.getDate();
}
function isTodayTradingDayBefore(dateStr) {
  const d = new Date(dateStr);
  if (isNaN(d)) return false;
  const before = prevTradingDay(d);
  const today = new Date();
  return before.getFullYear() === today.getFullYear()
      && before.getMonth() === today.getMonth()
      && before.getDate() === today.getDate();
}

/* NEW: NM detection (first trading day of month) */
function isFirstTradingDayOfMonth(date = new Date()) {
  const prev = prevTradingDay(date);
  return prev.getMonth() !== date.getMonth();
}

/* ===== UI INIT ===== */

function updateCpiUI() {
  const cpi = isCpiDay();
  document.getElementById('yesterdayOpen').disabled = cpi; // disable Yesterday's Open on CPI days only
}
document.addEventListener('DOMContentLoaded', updateCpiUI);

document.getElementById('todayDate').textContent =
  "Today’s Date: " + new Date().toLocaleDateString();

/* ===== MAIN CALCULATOR ===== */

function calculateStrategy() {
  const today = parseFloat(document.getElementById('todayOpen').value);       // VIX today open
  const yOpen = parseFloat(document.getElementById('yesterdayOpen').value);   // VIX yesterday open
  const yClose = parseFloat(document.getElementById('yesterdayClose').value); // VIX yesterday close

  if (isNaN(today) || isNaN(yClose) || (!isCpiDay() && isNaN(yOpen))) {
    alert("Please enter valid numbers.");
    return;
  }

  const now = new Date();
  const dayOfWeek = now.getDay(); // 0=Sun,1=Mon,...,5=Fri
  const isMonday = dayOfWeek === 1;
  const isFriday = dayOfWeek === 5;
  const isWednesday = dayOfWeek === 3;

  const nmToday = isFirstTradingDayOfMonth(now); /* NEW */

  const cpiToday = isCpiDay();
  const fedToday = isFedDay();
  const opexToday = isOpexDay();
  const postHoliday = isPostHoliday();
  const postOpexMonday = isPostOpexMonday();
  const eomTradingDay = isLastTradingDayOfMonth(now);
  const eomMinus1 = isEomMinusN(1, now);
  const eomMinus2 = isEomMinusN(2, now);
  const vixExpiryToday = isVixExpiryDay();

  const opexMinus1 = opexSchedule.some(isTodayTradingDayBefore);

  // context tags
  document.getElementById('cpiTag').style.display = cpiToday ? 'inline-block' : 'none';
  document.getElementById('fedTag').style.display = fedToday ? 'inline-block' : 'none';
  document.getElementById('opexTag').style.display = opexToday ? 'inline-block' : 'none';
  document.getElementById('postOpexTag').style.display = postOpexMonday ? 'inline-block' : 'none';
  document.getElementById('postHolidayTag').style.display = postHoliday ? 'inline-block' : 'none';
  document.getElementById('eomTag').style.display = eomTradingDay ? 'inline-block' : 'none';

  const openDiff = (isNaN(yOpen) ? NaN : yOpen - today); // ignored on CPI day
  const overnightDrop = yClose - today;                  // used on CPI + non-CPI

  // UI numbers
  document.getElementById('overnightDropDisplay').textContent =
    isNaN(overnightDrop) ? '—' : overnightDrop.toFixed(2);

  const openDiffDisplay = document.getElementById('openDiffDisplay');
  const openDiffNote = document.getElementById('openDiffNote');
  if (cpiToday) {
    openDiffDisplay.textContent = '—';
    openDiffNote.style.display = 'inline-block';
  } else {
    openDiffNote.style.display = 'none';
    openDiffDisplay.textContent = isNaN(openDiff) ? '—' : openDiff.toFixed(2);
  }

  let recommendation = "";
  let bgColor = "#eee";
  let crossedMain = false;
  let addPostOpexNote = false;

  if (cpiToday) {
    // CPI rule:
    // overnightDrop = Yesterday Close − Today Open
    // If > 0 (VIX down) => Long ATM Call @ 9:32 (max entry premium $13)
    // If <= 0 (VIX up or flat) => No Trade
    if (overnightDrop > 0) {
      recommendation = "Long ATM Call @ 9:32 AM (CPI day) — Max entry premium $13";
      bgColor = "#61f7d6";
    } else {
      recommendation = "No Trade (CPI day — VIX up)";
      bgColor = "#eee";
    }
  } else {
    // BASE non-CPI logic – GXBF has priority over open-to-open filter
    if (overnightDrop > 0.65) {
      recommendation = "GXBF @ 9:36 AM";
      bgColor = "#fff399";
    } else if (openDiff > 1.4) {
      recommendation = "M8 Butterfly";
      bgColor = "#b49aff";
    } else if (overnightDrop >= 0.01 && overnightDrop < 0.65) {
      recommendation = "Straddle @ 9:32 AM";
      bgColor = "#61f7d6";
    } else {
      recommendation = "M8 Butterfly";
      bgColor = "#b49aff";
    }

    // Fed-day: block ONLY M8 Butterfly; allow Straddle/GXBF
    if (fedToday && recommendation === "M8 Butterfly") {
      recommendation = "No M8BF (Fed day)";
      bgColor = "#eee";
      crossedMain = true;
    }

    // Day after market holiday: no M8 butterflies
    if (postHoliday && recommendation === "M8 Butterfly") {
      recommendation = "No M8BF (Post-holiday)";
      bgColor = "#eee";
      crossedMain = true;
    }

    /* NEW: NM override — if NM day and we'd be M8 (or got blocked as No M8BF), convert to NM Straddle.
       This explicitly overrides the post-holiday M8 block on NM days. */
    if (nmToday && (recommendation === "M8 Butterfly" || recommendation.startsWith("No M8BF"))) {
      recommendation = "NM Straddle @ 9:32 AM";
      bgColor = "#61f7d6";
      crossedMain = false;
    }

    // EOM override: last trading day of month forces Straddle
    if (eomTradingDay) {
      recommendation = "Straddle @ 9:32 AM (EOM Straddle)";
      bgColor = "#61f7d6";
      crossedMain = false;
    }

    // Wednesday rule: Wed + NOT Fed + NOT CPI + NOT EOM + NOT NM + Straddle -> M8
// NM overrides this rule (NM day keeps the straddle / NM straddle logic).
if (isWednesday && !fedToday && !cpiToday && !eomTradingDay && !nmToday && recommendation.startsWith("Straddle")) {
  recommendation = "M8 Butterfly";
  bgColor = "#b49aff";
}

    // OPEX day rule: no straddles on OPEX (still applies to NM Straddle)
    if (opexToday && recommendation.startsWith("Straddle")) {
      recommendation = "No Straddle (OPEX day)";
      bgColor = "#eee";
      crossedMain = true;
    }

    // Note on post-OPEX Mondays when M8 shows
    if (postOpexMonday && recommendation === "M8 Butterfly") {
      addPostOpexNote = true;
    }
  }

  // ---------- Render unified block ----------
  const recBlock = document.getElementById("recBlock");
  const mainRec = document.getElementById("mainRec");
  const pm1Line = document.getElementById("pm1Line");
  const bobfLine = document.getElementById("bobfLine");

  const mainText = addPostOpexNote
    ? `${recommendation} (use afternoon times for post OPEX Mondays)`
    : recommendation;

  mainRec.innerHTML = crossedMain
    ? `<span class="crossed">${mainText}</span>`
    : mainText;

  recBlock.style.backgroundColor = bgColor;

  /* ===== 1PM BF signal (rename + added low VIX + crossed when blocked) =====
     Rules:
     - Skip Mondays
     - Trade only on overnight VIX up days (overnightDrop < 0)
     - Skip monthly VIX expiration
     - Skip EOM and EOM-1
     - Skip if VIX today open < 16
  */
  let pm1Text = "1PM BF in play";
  let pm1Crossed = false;

  if (!(overnightDrop < 0)) {
    pm1Text = "No 1PM BF";
    pm1Crossed = true;
  } else if (isMonday) {
    pm1Text = "No 1PM BF (Monday)";
    pm1Crossed = true;
  } else if (vixExpiryToday) {
    pm1Text = "No 1PM BF (VIX expiration)";
    pm1Crossed = true;
  } else if (eomTradingDay) {
    pm1Text = "No 1PM BF (EOM)";
    pm1Crossed = true;
  } else if (eomMinus1) {
    pm1Text = "No 1PM BF (EOM-1)";
    pm1Crossed = true;
  } else if (!isNaN(today) && today < 16) {
    pm1Text = "No 1PM BF (low VIX)";
    pm1Crossed = true;
  }

  pm1Line.innerHTML = pm1Crossed ? `<span class="crossed">${pm1Text}</span>` : pm1Text;

  /* ===== BOBF signal (MIN VIX REMOVED, MAX VIX kept) =====
     Rules:
     - Skip Fridays
     - Skip monthly VIX expiration
     - Skip OPEX-1   ✅ ADDED
     - Skip EOM-2 and EOM-1
     - Max VIX 23
  */
  let bobfText = "BOBF in play";
  let bobfCrossed = false;

  if (isFriday) {
    bobfText = "No BOBF (Friday)";
    bobfCrossed = true;
  } else if (vixExpiryToday) {
    bobfText = "No BOBF (VIX expiration)";
    bobfCrossed = true;
  } else if (opexMinus1) {
    bobfText = "No BOBF (OPEX-1)";
    bobfCrossed = true;
  } else if (eomMinus2) {
    bobfText = "No BOBF (EOM-2)";
    bobfCrossed = true;
  } else if (eomMinus1) {
    bobfText = "No BOBF (EOM-1)";
    bobfCrossed = true;
  }

  // MAX VIX only
  if (!bobfCrossed && !isNaN(today) && today > 23) {
    bobfText = "No BOBF (high VIX)";
    bobfCrossed = true;
  }

  bobfLine.innerHTML = bobfCrossed ? `<span class="crossed">${bobfText}</span>` : bobfText;
}
</script>

</body>
</html>



