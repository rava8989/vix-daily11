<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VIX Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 20px; }
    button { padding: 10px 20px; font-size: 16px; }
    .result { margin-top: 20px; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    p { margin: 0.5em 0; }
  </style>
</head>
<body>
  <h1>üìà VIX Dashboard</h1>
  <button onclick="getVIXData()">üîÑ Update VIX Data</button>
  <div class="result" id="vixResults">Loading...</div>

  <script>
    const API_KEY = 'd1lisepr01qt4thgfjlgd1lisepr01qt4thgfjm0'; // Your real API key
    const SYMBOL = '^VIX';
    const resultsEl = document.getElementById('vixResults');

    async function getVIXData() {
      resultsEl.innerText = 'Fetching data...';

      const now = new Date();
      const todayStr = now.toISOString().split('T')[0];
      const toTimestamp = Math.floor(now.getTime() / 1000);
      const fromTimestamp = toTimestamp - (30 * 24 * 60 * 60);

      const url = `https://finnhub.io/api/v1/stock/candle?symbol=${encodeURIComponent(SYMBOL)}&resolution=D&from=${fromTimestamp}&to=${toTimestamp}&token=${API_KEY}`;

      try {
        const res = await fetch(url);
        const data = await res.json();

        if (data.s !== 'ok') {
          resultsEl.innerText = '‚ùå Error fetching data from Finnhub.';
          return;
        }

        const dateMap = {};
        for (let i = 0; i < data.t.length; i++) {
          const dateStr = new Date(data.t[i] * 1000).toISOString().split('T')[0];
          dateMap[dateStr] = i;
        }

        const availableDates = Object.keys(dateMap).sort().reverse();

        const todayDataIndex = dateMap[todayStr];
        let todayOpen, yestOpen, yestClose, yestDate;

        if (todayDataIndex !== undefined) {
          todayOpen = data.o[todayDataIndex];
        } else {
          const mostRecent = availableDates[0];
          todayOpen = data.o[dateMap[mostRecent]];
        }

        for (let i = 1; i < availableDates.length; i++) {
          const d = availableDates[i];
          const idx = dateMap[d];
          if (data.o[idx] && data.c[idx]) {
            yestOpen = data.o[idx];
            yestClose = data.c[idx];
            yestDate = d;
            break;
          }
        }

        if (!todayOpen || !yestOpen || !yestClose) {
          resultsEl.innerText = '‚ö†Ô∏è Could not find valid VIX data.';
          return;
        }

        const diffOpen = (yestOpen - todayOpen).toFixed(2);
        const diffClose = (yestClose - todayOpen).toFixed(2);

        resultsEl.innerHTML = `
          <p><strong>Today's Open (approx):</strong> ${todayOpen.toFixed(2)}</p>
          <p><strong>Used Previous Market Day:</strong> ${yestDate}</p>
          <p><strong>Yesterday's Open:</strong> ${yestOpen.toFixed(2)}</p>
          <p><strong>Yesterday's Close:</strong> ${yestClose.toFixed(2)}</p>
          <hr>
          <p><strong>Yesterday Open - Today Open:</strong> ${diffOpen}</p>
          <p><strong>Yesterday Close - Today Open:</strong> ${diffClose}</p>
        `;
      } catch (err) {
        console.error(err);
        resultsEl.innerText = '‚ùå Network error. Check browser console for details.';
      }
    }

    getVIXData();
  </script>
</body>
</html>
