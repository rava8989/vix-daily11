<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VIX Strategy Helper</title>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: row;
    }
    .sidebar {
      width: 250px;
      background: #fff;
      padding: 15px;
      border-right: 1px solid #ccc;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      height: 100vh;
      box-sizing: border-box;
      overflow-y: auto;
    }
    .sidebar h2 { font-size: 16px; margin-top: 0; }
    .sidebar .muted { font-size: 12px; color: #666; margin: 6px 0 10px 0; }
    .sidebar ul { padding-left: 18px; margin-top: 6px; margin-bottom: 18px; }

    .main { flex: 1; text-align: center; padding: 20px; }
    .calculator {
      background: #fff; padding: 15px; border-radius: 8px;
      box-shadow: 0 0 5px #ccc; max-width: 300px; margin: 0 auto 20px auto;
    }
    label { display: block; margin-top: 10px; }
    input { width: 100%; margin-top: 5px; margin-bottom: 10px; }
    input:disabled { opacity: 0.6; cursor: not-allowed; }
    button { width: 100%; padding: 8px; margin-top: 10px; }
    #recommendation {
      margin: 20px auto; font-size: 32px; font-weight: bold; color: #333;
      padding: 15px; max-width: 700px; border-radius: 8px; box-shadow: 0 0 5px #ccc;
    }
    .flowchart { margin: 20px auto; max-width: 100%; overflow-x: auto; }
    .notes {
      background: #fff; padding: 15px; margin: 20px auto; max-width: 600px;
      border-radius: 8px; box-shadow: 0 0 5px #ccc; text-align: left;
    }
    .notes h2 { font-size: 18px; margin-top: 0; }
    .tag {
      display: inline-block; padding: 2px 6px; border-radius: 6px; font-size: 11px;
      border: 1px solid #ccc; color: #555; margin-left: 6px; background: #fafafa;
    }

    .strategy-doc {
      background: #fff;
      padding: 20px;
      margin: 20px auto 60px auto;
      max-width: 900px;
      border-radius: 10px;
      box-shadow: 0 0 5px #ccc;
      text-align: left;
      line-height: 1.5;
    }
    .strategy-doc h2 { font-size: 20px; margin: 0 0 10px 0; }
    .strategy-doc h3 { font-size: 16px; margin: 18px 0 8px 0; color: #333; }
    .strategy-doc .divider { margin: 16px 0; text-align: center; color: #999; letter-spacing: 2px; }
    .strategy-doc ul { margin: 6px 0 12px 22px; }
    .strategy-doc li { margin: 2px 0; }
    .muted-note { font-size: 12px; color: #666; margin-top: 6px; }
    .highlight {
      background: #f6f6ff;
      border-left: 3px solid #b49aff;
      padding: 10px 12px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<div class="sidebar">
  <h2>M8 Butterfly Trading Times</h2>
  <ul id="bfTimesList"></ul>

  <h2>Straddle Trading Time</h2>
  <p>9:32 AM</p>
  <p class="muted">Last update: 8/23/2025</p>

  <!-- CPI Schedule -->
  <h2>CPI Schedule</h2>
  <ul id="cpiSchedule"></ul>

  <!-- Fed Day Schedule -->
  <h2>Fed Day Schedule</h2>
  <ul id="fedSchedule"></ul>
</div>

<div class="main">

  <div class="calculator">
    <h1>VIX Calculator</h1>
    <label>VIX Todayâ€™s Open:
      <input type="number" id="todayOpen" step="0.01" />
    </label>
    <label>VIX Yesterdayâ€™s Open:
      <input type="number" id="yesterdayOpen" step="0.01" />
    </label>
    <label>VIX Yesterdayâ€™s Close:
      <input type="number" id="yesterdayClose" step="0.01" />
    </label>
    <button onclick="calculateStrategy()">Calculate</button>
  </div>

  <div style="margin-top: 10px; font-size: 14px; text-align: center;">
    <p>
      <strong>Overnight VIX Drop:</strong>
      <span id="overnightDropDisplay">â€”</span>
      <span id="cpiTag" class="tag" style="display:none;">CPI day</span>
      <span id="fedTag" class="tag" style="display:none;">Fed day</span>
    </p>
    <p>
      <strong>Yesterdayâ€™s VIX Open âˆ’ Todayâ€™s VIX Open:</strong>
      <span id="openDiffDisplay">â€”</span>
      <span id="openDiffNote" class="tag" style="display:none;">ignored on CPI day</span>
    </p>
  </div>

  <div style="text-align: right;">
    <div id="todayDate" style="font-size: 14px; color: #666; margin-bottom: 5px;"></div>
  </div>
  <div id="recommendation"></div>

  <div class="flowchart">
    <div class="mermaid">
flowchart TD
    A[SPX overnight gap UP/DOWN &lt; 0.9%?]
    A -->|No| B1[M8 Butterfly]
    A -->|Yes| C[Yesterday's VIX open - Today's VIX open &lt; 1.4?]
    C -->|No| B2[M8 Butterfly]
    C -->|Yes| D[Overnight VIX drop &gt; 0.65?]
    D -->|Yes| E[BvS Butterfly @ 9:36 AM]
    D -->|No| F[Overnight VIX drop 0.01â€“0.65?]
    F -->|Yes| G[Straddle @ 9:32 AM]
    F -->|No| B3[M8 Butterfly]

    class B1,B2,B3 butterfly
    class E atm
    class G straddle

    classDef butterfly fill:#b49aff,stroke:#333,stroke-width:1px
    classDef straddle fill:#61f7d6,stroke:#333,stroke-width:1px
    classDef atm fill:#fff399,stroke:#333,stroke-width:1px
    </div>
  </div>

  <div class="notes">
    <h2>Notes</h2>
    <ul>
      <li><strong>No M8 Butterfly on FED day</strong> (BvS allowed)</li>
      <li><strong>Max Risk:</strong></li>
      <ul>
        <li>Straddle â€” $3200</li>
        <li>Butterfly â€” $1300 - $1400</li>
      </ul>
      <li><strong>VIX open time:</strong> first VIX print after 9:30 AM</li>
      <li><strong>VIX close time:</strong> 4:15 PM</li>
      <li>On CPI days, use only: Yesterdayâ€™s Close âˆ’ Todayâ€™s Open.</li>
      <li>On Wednesdays without Fed/CPI, replace Straddle signals with M8 Butterfly.</li>
      <li><strong>Avoid trades on quarterly OPEX</strong></li>
      <li><strong>Use $2700 TP on Thursday Straddles</strong></li>
    </ul>
  </div>

  <section class="strategy-doc" id="strategy-doc">
    <h2>Hybrid SPX 0DTE Strategy â€” Overview</h2>
    <p>This is the hybrid SPX 0DTE strategy. It classifies days into three distinct types:</p>

    <div class="highlight">
      <h3>Teal Days â€” Straddle</h3>
      <ul>
        <li>Traded between <strong>9:32 AM</strong> and <strong>1:30 PM</strong>.</li>
      </ul>

      <h3>Purple Days â€” M8 Butterfly</h3>
      <ul>
        <li>Based on M8â€™s recommendation, with entry times varying by day of the week.</li>
        <li>This setup is less effective without TTV software, which helps identify optimal entry windows for butterflies.</li>
        <li>Iâ€™ll try my best to update the best entry times weekly on my webpage.</li>
      </ul>

      <h3>Yellow Days â€” BvS Butterfly</h3>
      <ul>
        <li>Traded at <strong>9:36 AM</strong>, centered around a major positive gamma value taken from <strong>9:35 AM gex-bot-stream</strong> feed.</li>
      </ul>
    </div>

    <div class="divider">â¸»</div>

    <h3>Rules for Day Classification</h3>
    <p>Hereâ€™s the logic:</p>
    <ul>
      <li><strong>Check SPX overnight gap at the open:</strong><br/>
        â€¢ If the gap (up or down) is <strong>greater than 0.9%</strong>, itâ€™s a <strong>Purple Day</strong>.<br/>
        â€¢ If the gap is <strong>less than 0.9%</strong>, check the next items:
      </li>
      <li><strong>Open-to-open VIX:</strong> Yesterdayâ€™s VIX open minus todayâ€™s VIX open.<br/>
        â€¢ If this value is <strong>more than 1.4</strong>, itâ€™s a <strong>Purple Day</strong>.<br/>
        â€¢ If not, continue to the next condition.
      </li>
      <li><strong>Check overnight VIX drop:</strong> (Yesterdayâ€™s VIX close at 4:15 PM minus todayâ€™s VIX open at 9:30 AM)<br/>
        â€¢ If the drop is <strong>more than 0.65</strong>, itâ€™s a <strong>Yellow Day</strong>.<br/>
        â€¢ If the drop is <strong>between 0.01 and 0.65</strong>, itâ€™s a <strong>Teal Day</strong>.<br/>
        â€¢ If none of the above conditions are met, itâ€™s a <strong>Purple Day</strong>.
      </li>
    </ul>

    <ul>
      <li>If a <strong>Purple Day</strong> falls on a <strong>FED day</strong>, <strong>skip the trade</strong>.</li>
      <li><em>On Teal Days</em>, if the straddle doesnâ€™t trigger by <strong>1:30 PM</strong> due to high VIX, cancel the order â€” thatâ€™s expected.</li>
      <li><em>On CPI days</em>, we use only one filter: <strong>overnight VIX movement</strong>. If the VIX is up, we donâ€™t trade; if itâ€™s down, we trade straddles.</li>
      <li>If the <strong>M8 SPX Butterfly prediction</strong> has a <strong>0% win rate for the entire day</strong>, then the next day we automatically take a <strong>9:32 AM Straddle</strong> trade, using the same rules as the overnight VIX-down (Teal day) straddle.</li>
      <li><strong>On non-Fed, non-CPI Wednesdays</strong>, if a straddle signal appears, <strong>replace it with M8 butterflies</strong>.</li>
    </ul>

    <h3>Money Management</h3>
    <ul>
      <li><strong>Butterflies (Purple & Yellow Days):</strong><br/>
        Max risk is <strong>$1,400</strong>. Widen the wings until the debit is close to this number. If the next strike pushes the cost over $1,400, itâ€™s acceptable to settle near <strong>$1,000</strong>.
      </li>
      <li><strong>Straddle (Teal Days):</strong><br/>
        Max risk is <strong>$3,200</strong>, the same as used in Madâ€™s strategy.
      </li>
      <li>All trades are held to <strong>expiration</strong>.</li>
    </ul>

    <h3>Backtest Results (September 1, 2024 â†’ August 31, 2025)</h3>
    <ul>
      <li><strong>Teal Days (Straddle):</strong> +$60K</li>
      <li><strong>Purple Days (M8 Butterfly):</strong> +$54K</li>
      <li><strong>Yellow Days (BvS Butterfly):</strong> +$17K</li>
      <li><strong>Total P/L:</strong> ~<strong>$132K</strong> in a year, with May being the only negative month.</li>
      <li><em>Only one trade is allowed per day. Some days may have no trade if conditions arenâ€™t met.</em></li>
    </ul>

    <div class="divider">â¸»</div>

    <p>I know the rules can seem complicated at first, which is why I created a calculator page. Simply input the VIX data, and it will indicate the type of day it is.</p>

    <p class="muted-note"><strong>Disclaimer:</strong> This content is for informational and educational purposes only and does not constitute financial, investment, or trading advice. Past performance is not indicative of future results. Trading options involves significant risk and may not be suitable for all investors. You are solely responsible for your own investment decisions.</p>
  </section>

</div>

<script>
const bfTimes = {
  1: { day: "Monday", time: "9:35 AM" },
  2: { day: "Tuesday", time: "10:50 AM" },
  3: { day: "Wednesday", time: "1:35 PM" },
  4: { day: "Thursday", time: "2:00 PM" },
  5: { day: "Friday", time: "10:55 AM" }
};

function renderBFList() {
  const ul = document.getElementById('bfTimesList');
  for (let i = 1; i <= 5; i++) {
    const li = document.createElement('li');
    li.textContent = `${bfTimes[i].day} â€” ${bfTimes[i].time}`;
    ul.appendChild(li);
  }
}
renderBFList();

// CPI dates starting September 2025
const cpiSchedule = [
  "September 11, 2025",
  "October 15, 2025",
  "November 13, 2025",
  "December 10, 2025"
];
function renderCPISchedule() {
  const ul = document.getElementById('cpiSchedule');
  cpiSchedule.forEach(date => {
    const li = document.createElement('li');
    li.textContent = date;
    ul.appendChild(li);
  });
}
renderCPISchedule();

// Fed Day dates
const fedSchedule = [
  "September 17, 2025",
  "October 29, 2025",
  "December 10, 2025"
];
function renderFedSchedule() {
  const ul = document.getElementById('fedSchedule');
  fedSchedule.forEach(date => {
    const li = document.createElement('li');
    li.textContent = date;
    ul.appendChild(li);
  });
}
renderFedSchedule();

function todayLongUS() {
  return new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}
function isCpiDay() {
  return cpiSchedule.includes(todayLongUS());
}
function isFedDay() {
  return fedSchedule.includes(todayLongUS());
}

// On load, reflect CPI-day UI
function updateCpiUI() {
  const cpi = isCpiDay();
  document.getElementById('yesterdayOpen').disabled = cpi; // disable Yesterday's Open on CPI days only
}
document.addEventListener('DOMContentLoaded', updateCpiUI);

document.getElementById('todayDate').textContent =
  "Todayâ€™s Date: " + new Date().toLocaleDateString();

function calculateStrategy() {
  const today = parseFloat(document.getElementById('todayOpen').value);
  const yOpen = parseFloat(document.getElementById('yesterdayOpen').value);
  const yClose = parseFloat(document.getElementById('yesterdayClose').value);

  if (isNaN(today) || isNaN(yClose) || (!isCpiDay() && isNaN(yOpen))) {
    alert("Please enter valid numbers.");
    return;
  }

  const cpiToday = isCpiDay();
  const fedToday = isFedDay();
  const dayOfWeek = new Date().getDay(); // 0=Sun,1=Mon,...,3=Wed
  const bfTime = bfTimes[dayOfWeek]?.time || "";

  const openDiff = (isNaN(yOpen) ? NaN : yOpen - today); // ignored on CPI day
  const overnightDrop = yClose - today; // used on CPI + non-CPI

  // UI tags/fields
  const overnightDropDisplay = document.getElementById('overnightDropDisplay');
  const openDiffDisplay = document.getElementById('openDiffDisplay');
  const cpiTag = document.getElementById('cpiTag');
  const fedTag = document.getElementById('fedTag');
  const openDiffNote = document.getElementById('openDiffNote');

  overnightDropDisplay.textContent = isNaN(overnightDrop) ? 'â€”' : overnightDrop.toFixed(2);
  document.getElementById('yesterdayOpen').disabled = cpiToday;

  cpiTag.style.display = cpiToday ? 'inline-block' : 'none';
  fedTag.style.display = fedToday ? 'inline-block' : 'none';

  if (cpiToday) {
    openDiffDisplay.textContent = 'â€”';
    openDiffNote.style.display = 'inline-block';
  } else {
    openDiffNote.style.display = 'none';
    openDiffDisplay.textContent = isNaN(openDiff) ? 'â€”' : openDiff.toFixed(2);
  }

  let recommendation = "";
  let bgColor = "#eee";

  if (cpiToday) {
    // CPI: use Yesterdayâ€™s Close âˆ’ Todayâ€™s Open only
    if (overnightDrop < 0) {
      recommendation = "No Trade (CPI day)";
      bgColor = "#eee";
    } else {
      recommendation = "Straddle @ 9:32 AM (CPI day)";
      bgColor = "#61f7d6";
    }
  } else {
    // BASE non-CPI logic
    if (overnightDrop > 0.65 && openDiff < 1.4) {
      recommendation = "BvS Butterfly @ 9:36 AM";
      bgColor = "#fff399";
    } else if (overnightDrop >= 0.01 && overnightDrop < 0.65 && openDiff < 1.4) {
      recommendation = "Straddle @ 9:32 AM";
      bgColor = "#61f7d6";
    } else {
      recommendation = `M8 Butterfly â€” ${bfTime}`;
      bgColor = "#b49aff";
    }

    // Fed-day override: block ONLY M8 Butterfly; allow BvS Butterfly
    if (fedToday) {
      if (/M8 Butterfly/.test(recommendation)) {
        recommendation = "No Trade (Fed day â€” no M8 butterflies)";
        bgColor = "#eee";
      }
      // BvS Butterfly remains allowed
    }

    // Wednesday rule: Wed + NOT Fed + NOT CPI + Straddle -> crossed-out Straddle â†’ M8
    const isWednesday = dayOfWeek === 3;
    if (isWednesday && !fedToday && !cpiToday && /Straddle/.test(recommendation)) {
      const crossed = `<span style="text-decoration: line-through;">Straddle @ 9:32 AM</span>`;
      recommendation = `${crossed} â†’ M8 Butterfly â€” ${bfTime}`;
      bgColor = "#b49aff";
    }
  }

  const recBox = document.getElementById("recommendation");
  recBox.innerHTML = `ðŸ‘‰ <span style="font-size: 36px;">${recommendation}</span>`;
  recBox.style.backgroundColor = bgColor;
}
</script>

</body>
</html>
